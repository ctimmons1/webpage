---
title: "The Environmental Impact of Oil Pipeline Spills"
author: "Caitlin Timmons, Sarah Weden, Kendall Al-Bashir"
date: "Last updated on `r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    theme: paper
    toc: true
    toc_depth: 2
    toc_float: true
    df_print: kable
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE, 
  fig.width = 16/2, fig.height = 9/2)
```

<!--
Comments in HTML are like this! 
-->




# "Liquid Gold": Oil's Expense On the Environment

The following scatterplot demonstrates how, for a representative sample of pipeline spills, the amount of oil released in the spill directly correlates to the costs paid out by the responsible corporation to repair environmental damage. This reinforces what is already known about the severe damage that oil poses to ecological systems, and shows that the amount of oil released can be used as another proxy by which to quantify the environmental hazard of any particular pipeline spill. 


``` {r, echo =TRUE, message =FALSE, warning =FALSE, fig.width = 10, fig.height = 10}
library(tidyverse)
library(leaflet)
library(sf)
library(readxl)
library(maps)
library(USAboundaries)

us_counties <- us_counties(map_date = NULL, resolution = c("high"), states = NULL) %>%
  select(name, state_abbr) %>%
  mutate("State_ID" = state_abbr, "County" = name) %>%
  filter(State_ID != "GU", State_ID != "VI", State_ID != "PR", State_ID != "AS", State_ID != "MP", State_ID != "HI", State_ID != "AK") 


USA_sf <- maps::map("state", plot = FALSE, fill = TRUE) %>%
  sf::st_as_sf() %>%
  sf::st_transform(4326) %>%
  mutate("State" = ID) %>%
  select(-ID)


pipeline_spills <- pipeline_spills <- read_excel("database.xlsx") %>%
  unite(col = "Accident_Location", c("Accident_City", "Accident_State"), sep = ", ", remove = FALSE) %>%
  mutate("State_ID" = Accident_State, "Barrels_Gallons" = Unintentional_Release_Barrels*42) %>%
  separate(col = Operator_Name, into = c("Operator_General"), sep = " ", remove = FALSE, convert = FALSE, 
           extra = "drop", fill = "warn") %>%
  filter(Environmental_Remediation_Costs > 0, Longitude < -60)

```



```{r, echo =TRUE, message =FALSE, warning =FALSE, fig.width = 10, fig.height = 8}

pipeline_operators <- pipeline_spills %>%
  group_by(Operator_General) %>%
  summarize(n_spills = n()) %>%
  filter(n_spills > 5) %>%
  inner_join(pipeline_spills, by = "Operator_General") 

ggplot(data = pipeline_spills, mapping = aes(x = Barrels_Gallons, y = Environmental_Remediation_Costs)) +
  geom_jitter(width = 0.3, height = 0.3, alpha = 0.7) +
  geom_smooth(method = lm) +
  scale_y_log10() +
  scale_x_log10() +
  labs(title = "Correlation between amount of oil spillage and cost to the environment", subtitle = "Gallons of oil released in each pipeline spill versus the environmental remediation costs of the spill. 
Regression line demonstrates positive trend.", x = "Oil Released (Gallons)", y = "Environmental Remediation Costs ($)")

```

# Who Is Responsible for the Environmental Damage?

We already saw in an initial map some of the corporations responsible for pipeline spills between 2010 and 2017. But not all of these companies are contributing equally to environmental damage. The following barplot reveals the corporations most culpable for environmental damage, by calculating the total amount of oil they have released into the environment. All of these companies experienced more than 5 spills in this timeframe, already increasing their accountability for this kind of pollution. Be sure to note the scale on the x-axis, which represents the total gallons of oil released into the environment. The numbers are quite large, which means that even corporations with the smallest bars are still causing a significant amount of pollution. 

```{r, echo =TRUE, message =FALSE, warning =FALSE, fig.width = 10, fig.height = 8}

pipeline_barrels <- pipeline_operators %>%
  group_by(Operator_General) %>%
  summarize(Sum_Gallons = sum(Barrels_Gallons)) %>%
  mutate(Operator_General = reorder(Operator_General, -Sum_Gallons)) %>%
  filter(Sum_Gallons > 1000)

ggplot(data = pipeline_barrels, mapping = aes(x = Operator_General, y = Sum_Gallons)) +
  geom_col(fill = "red") +
  coord_flip() +
  scale_fill_discrete(guide = FALSE) +
  labs(title = "Which Corporations Spilled the Most Oil?", subtitle = "Barplot representing the total gallons of oil released by most culpable corporations from 2010-present.", y = "Total Oil Released (Gallons)", x = "Corporation Name")

```


# Pipeline Spills and Overall Pollution

We then wanted to examine how these pipeline spills fit in with the larger scheme of pollution in different areas around the country. This information is relevant given the far-reaching and long-lasting effects of pipeline spills; they may be contributing to or worsening existing pollution. The following map uses data collected from the U.S Environmental Protection Agency to map the total ozone release levels (in blue) by county between 2000 and 2016. The units “parts per billion” is a measure of volume which denotes the concentration of pollutants in the air. Pipeline spills are marked by pink points.

Although the pollution data does not represent every county, we can see that especially on the West coast, areas with many oil spills overlap with high levels of pollution, meaning that these pipelines are damaging an already damaged system. Moreover, in less-populated areas of the country with relatively high ozone release levels, it is likely that these pipelines are a significant contributor to that pollution. 


``` {r, echo =TRUE, message =FALSE, warning =FALSE, fig.width = 14, fig.height = 14}

pollution <- read_excel("pollution.xlsx") %>%
  separate(col = Date_Local, into = c("Year", "Month", "Day"), sep = "-", 
           convert = FALSE, extra = "warn", fill = "warn") %>%
  group_by(County) %>%
  summarize(Sum_O3 = sum(O3_Mean)) %>%
  right_join(us_counties, by = "County") %>%
  select(-c(name, state_abbr)) %>%
  drop_na()

pipeline_spills_sf <- pipeline_spills %>%
  filter(Longitude >= -130) %>%
  st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326) 

ggplot() +
  geom_sf(data = USA_sf) +
  geom_sf(data = pollution, aes(fill = Sum_O3)) +
  scale_fill_continuous(low = "lightblue3", high = "navy", 
                        space = "Lab", na.value = "white",         
                        guide = "colourbar", aesthetics = "fill") +
  geom_sf(data = pipeline_spills_sf, size = 0.7, col = "deeppink2") +
  coord_sf(crs = 4326) +
  labs(title = "Relationship Between Pollution Levels and Pipeline Spills", 
       subtitle = "Total ozone release by county from 2000-2016, plotted against occurrances of oil pipeline spills from 2010-present", x = "Longitude", y = "Latitude", fill = "Total O3 Release (Parts Per Billion)")

```
